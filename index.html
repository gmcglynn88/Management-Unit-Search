<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Genesys Cloud Client Credentials Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      font-size: 1em;
    }
    #results {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h1>Genesys Cloud API Test (Client Credentials)</h1>

<p><strong>Warning:</strong> This approach is insecure for production because it exposes your client secret in browser-visible code.</p>

<button id="getTokenBtn">Get Token</button>
<button id="listUsersBtn" disabled>List Users</button>

<div id="results"></div>

<script>
  // Replace these with your actual Client Credentials
  const CLIENT_ID = "5f8da5c2-f8ef-4168-a321-f06e16f558f3";
  const CLIENT_SECRET = "g3O12FzcJJHiDI4wKnRb-2NSnrasAH3m1q4Zjg2gziE";

  // Ireland login & API URLs
  const OAUTH_TOKEN_URL = "https://login.mypurecloud.ie/oauth/token";
  const API_BASE_URL    = "https://api.mypurecloud.ie";

  let accessToken = null;

  // 1) Obtain a token using Client Credentials
  async function fetchClientCredentialsToken() {
    // Basic Auth requires base64-encoded "clientId:clientSecret"
    const base64Auth = btoa(`${CLIENT_ID}:${CLIENT_SECRET}`);

    // Body for grant_type=client_credentials
    const bodyData = new URLSearchParams();
    bodyData.append("grant_type", "client_credentials");

    const response = await fetch(OAUTH_TOKEN_URL, {
      method: "POST",
      headers: {
        "Authorization": `Basic ${base64Auth}`,
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: bodyData.toString()
    });

    if (!response.ok) {
      throw new Error(`Failed to get token: HTTP ${response.status}`);
    }

    const tokenData = await response.json();
    return tokenData.access_token;
  }

  // 2) Example: List up to 10 users
  async function listUsers() {
    if (!accessToken) {
      alert("No access token. Please get a token first.");
      return;
    }

    const response = await fetch(`${API_BASE_URL}/api/v2/users?limit=10`, {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${accessToken}`
      }
    });

    if (!response.ok) {
      throw new Error(`Failed to list users: HTTP ${response.status}`);
    }

    const data = await response.json();
    return data;
  }

  // Hook up the buttons
  document.getElementById("getTokenBtn").addEventListener("click", async () => {
    const resultsDiv = document.getElementById("results");
    resultsDiv.textContent = "Requesting token...";

    try {
      accessToken = await fetchClientCredentialsToken();
      resultsDiv.textContent = `Got Token: ${accessToken}`;
      console.log("Access Token:", accessToken);

      document.getElementById("listUsersBtn").disabled = false;
    } catch (err) {
      console.error(err);
      resultsDiv.textContent = `Error: ${err.message}`;
    }
  });

  document.getElementById("listUsersBtn").addEventListener("click", async () => {
    const resultsDiv = document.getElementById("results");
    resultsDiv.textContent = "Listing users...";

    try {
      const data = await listUsers();
      // Just display user names in the results
      const userList = (data.entities || []).map(u => u.name || u.id).join(", ");
      resultsDiv.textContent = "Users: " + (userList || "None found");
    } catch (err) {
      console.error(err);
      resultsDiv.textContent = `Error: ${err.message}`;
    }
  });
</script>

</body>
</html>
